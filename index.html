<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zylos - Exam Software</title>
    
    <!-- ========== PWA METADATA ========== -->
    <!-- Required for PWA Installation -->
    <meta name="theme-color" content="#1a2a6c">
    <meta name="description" content="Zylos - Secure online examination platform">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Zylos Exam">
    
    <!-- Favicon and PWA Icons -->
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/000000/exam.png">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/000000/exam.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" id="app-manifest">
    
    <!-- ========== EXTERNAL STYLES ========== -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1a2a6c, #2a3a8c);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 15px 15px;
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: none;
        }

        .active-card {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #1a2a6c;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
            font-size: 1.8rem;
        }

        h3 {
            color: #2a3a8c;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #2a3a8c;
            outline: none;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(to right, #1a2a6c, #2a3a8c);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            background: linear-gradient(to right, #2a3a8c, #3a4a9c);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 58, 140, 0.2);
        }

        .btn-secondary {
            background: linear-gradient(to right, #6c757d, #7a8288);
        }

        .btn-secondary:hover {
            background: linear-gradient(to right, #7a8288, #8a9298);
        }

        .btn-success {
            background: linear-gradient(to right, #28a745, #34ce57);
        }

        .btn-success:hover {
            background: linear-gradient(to right, #34ce57, #40e567);
        }

        .btn-danger {
            background: linear-gradient(to right, #dc3545, #e4606d);
        }

        .btn-danger:hover {
            background: linear-gradient(to right, #e4606d, #ec7c87);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .exam-type-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .exam-type {
            flex: 1;
            text-align: center;
            padding: 25px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .exam-type:hover {
            border-color: #2a3a8c;
            transform: translateY(-5px);
        }

        .exam-type.selected {
            border-color: #2a3a6c;
            background-color: rgba(26, 42, 108, 0.05);
            box-shadow: 0 5px 15px rgba(26, 42, 108, 0.1);
        }

        .exam-type i {
            font-size: 2.5rem;
            color: #2a3a8c;
            margin-bottom: 15px;
        }

        .exam-type h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #2a3a8c;
        }

        .question-container {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f9f9f9;
            border-left: 4px solid #2a3a8c;
        }

        .option-container {
            margin: 15px 0;
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid #ddd;
            transition: all 0.2s;
        }

        .option-label:hover {
            background-color: #f0f2ff;
            border-color: #2a3a8c;
        }

        .option-label input {
            width: auto;
            margin-right: 10px;
        }

        .links-container {
            background: #f0f2ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .link-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #ddd;
        }

        .link-text {
            font-family: monospace;
            color: #2a3a8c;
            font-weight: 600;
            word-break: break-all;
            padding-right: 10px;
        }

        .copy-btn {
            background: #2a3a8c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: #1a2a6c;
        }

        .dashboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .dashboard-table th, .dashboard-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .dashboard-table th {
            background-color: #2a3a8c;
            color: white;
            font-weight: 600;
        }

        .dashboard-table tr:hover {
            background-color: #f9f9f9;
        }

        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .warning i {
            color: #ffc107;
            font-size: 1.5rem;
        }

        .timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2a3a8c;
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .timer.warning-time {
            color: #dc3545;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .tab-container {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #2a3a8c;
            border-bottom: 4px solid #2a3a8c;
        }

        .tab:hover:not(.active) {
            color: #2a3a8c;
            background-color: rgba(42, 58, 140, 0.05);
        }

        .student-info {
            display: flex;
            justify-content: space-between;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .student-name {
            font-weight: 700;
            font-size: 1.2rem;
            color: #2a3a8c;
        }

        .kicked-warning {
            color: #dc3545;
            font-weight: 600;
            background-color: rgba(220, 53, 69, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #ddd;
        }

        .developer {
            font-weight: 600;
            color: #2a3a8c;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .exam-type-selector {
                flex-direction: column;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .student-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .logo h1 {
                font-size: 2rem;
            }
            
            .tab-container {
                flex-direction: column;
            }
            
            .tab {
                text-align: center;
                border-bottom: 1px solid #ddd;
            }
            
            .tab.active {
                border-bottom: 4px solid #2a3a8c;
            }
        }

        /* Strict exam mode styles */
        .strict-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #dc3545;
            color: white;
            text-align: center;
            padding: 10px;
            font-weight: 700;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-size: 2rem;
            text-align: center;
            padding: 20px;
        }

        .fullscreen-overlay i {
            font-size: 4rem;
            margin-bottom: 30px;
            color: #dc3545;
        }

        /* ========== PWA INSTALL BUTTON STYLES ========== */
        .pwa-install-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
        }

        .pwa-install-btn {
            background: linear-gradient(135deg, #1a2a6c, #2a3a8c);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(26, 42, 108, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .pwa-install-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(26, 42, 108, 0.4);
        }

        .pwa-install-btn.hidden {
            display: none;
        }

        .install-icon {
            font-size: 1.2rem;
        }

        /* PWA Install Prompt Styles */
        .install-prompt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            padding: 20px;
        }

        .install-prompt-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .install-prompt-icon {
            font-size: 4rem;
            color: #1a2a6c;
            margin-bottom: 20px;
        }

        .install-prompt-title {
            color: #1a2a6c;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .install-prompt-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .install-prompt-buttons button {
            flex: 1;
        }
    </style>
   
</head>
<body>
    <!-- PWA Install Button -->
    <div class="pwa-install-container">
        <button id="pwaInstallBtn" class="pwa-install-btn hidden">
            <i class="fas fa-download install-icon"></i>
            Install App
        </button>
    </div>

    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt-overlay" style="display: none;">
        <div class="install-prompt-card">
            <i class="fas fa-mobile-alt install-prompt-icon"></i>
            <h2 class="install-prompt-title">Install Zylos Exam</h2>
            <p>Install this app on your home screen for quick and easy access when you're offline.</p>
            <p>It works just like a native app!</p>
            <div class="install-prompt-buttons">
                <button id="cancelInstall" class="btn btn-secondary">Not Now</button>
                <button id="confirmInstall" class="btn">Install Now</button>
            </div>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>Zylos Exam</h1>
            </div>
            <p class="tagline">Secure online examination platform</p>
            <p style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">
                <i class="fas fa-mobile-alt"></i> Installable App
            </p>
        </div>
    </header>

    <div class="container">
        <div class="tab-container">
            <div class="tab active" data-tab="create">Create Exam</div>
            <div class="tab" data-tab="take">Take Exam</div>
            <div class="tab" data-tab="results">Results Dashboard</div>
        </div>

        <div class="main-content">
            <!-- Create Exam Card -->
            <div id="create-exam-card" class="card active-card">
                <h2>Create New Exam</h2>
                <div class="warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>Remember: Students will be kicked out if they switch tabs or try to copy questions. For broad questions, students will submit answers via WhatsApp.</div>
                </div>
                
                <form id="exam-creation-form">
                    <div class="form-group">
                        <label for="teacher-name">Teacher's Name</label>
                        <input type="text" id="teacher-name" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="exam-title">Exam Title</label>
                        <input type="text" id="exam-title" placeholder="e.g., Midterm Examination 2023" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="total-marks">Total Marks</label>
                        <input type="number" id="total-marks" placeholder="e.g., 100" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="exam-duration">Exam Duration (minutes)</label>
                        <input type="number" id="exam-duration" placeholder="e.g., 60" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Exam Type</label>
                        <div class="exam-type-selector">
                            <div class="exam-type" data-type="broad">
                                <i class="fas fa-file-alt"></i>
                                <h4>Broad Questions</h4>
                                <p>Essay-type questions only</p>
                            </div>
                            <div class="exam-type" data-type="mcq">
                                <i class="fas fa-list-ol"></i>
                                <h4>MCQ & Short Answer</h4>
                                <p>Multiple choice and short questions</p>
                            </div>
                            <div class="exam-type" data-type="mixed">
                                <i class="fas fa-blender"></i>
                                <h4>Mixed</h4>
                                <p>Both broad and MCQ questions</p>
                            </div>
                        </div>
                        <input type="hidden" id="exam-type" value="broad" required>
                    </div>
                    
                    <div id="questions-container">
                        <!-- Questions will be added here dynamically -->
                    </div>
                    
                    <div class="btn-group">
                        <button type="button" id="add-question-btn" class="btn"><i class="fas fa-plus"></i> Add Question</button>
                        <button type="submit" class="btn btn-success">Create Exam & Generate Links</button>
                    </div>
                </form>
            </div>

            <!-- Take Exam Card -->
            <div id="take-exam-card" class="card">
                <h2>Take Exam</h2>
                <div id="exam-entry">
                    <div class="form-group">
                        <label for="exam-link">Exam Link</label>
                        <input type="text" id="exam-link" placeholder="Paste the exam link here">
                    </div>
                    <div class="form-group">
                        <label for="student-name">Your Name</label>
                        <input type="text" id="student-name" placeholder="Enter your full name">
                    </div>
                    <button id="join-exam-btn" class="btn">Join Exam</button>
                </div>
                
                <div id="exam-taking" style="display: none;">
                    <div class="student-info">
                        <div>
                            <span class="student-name" id="current-student-name"></span> - 
                            <span id="current-exam-title"></span>
                        </div>
                        <div class="timer" id="exam-timer">60:00</div>
                    </div>
                    
                    <div id="strict-warning" class="strict-warning" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i> Warning: Do not switch tabs or copy questions!
                    </div>
                    
                    <div id="exam-questions-container">
                        <!-- Exam questions will be loaded here -->
                    </div>
                    
                    <div class="btn-group">
                        <button id="submit-exam-btn" class="btn btn-success">Submit Exam</button>
                    </div>
                </div>
            </div>

            <!-- Results Dashboard Card -->
            <div id="results-card" class="card">
                <h2>Results Dashboard</h2>
                <div class="form-group">
                    <label for="dashboard-link">Dashboard Link</label>
                    <input type="text" id="dashboard-link" placeholder="Paste your dashboard link here">
                </div>
                <button id="load-dashboard-btn" class="btn">Load Dashboard</button>
                
                <div id="dashboard-content" style="display: none;">
                    <h3 id="dashboard-exam-title"></h3>
                    <div class="links-container">
                        <div class="link-box">
                            <div>
                                <strong>Exam Link:</strong>
                                <div class="link-text" id="dashboard-exam-link"></div>
                            </div>
                            <button class="copy-btn copy-exam-link"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div class="link-box">
                            <div>
                                <strong>Dashboard Link:</strong>
                                <div class="link-text" id="dashboard-dashboard-link"></div>
                            </div>
                            <button class="copy-btn copy-dashboard-link"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                    </div>
                    
                    <h3>Student Results</h3>
                    <table class="dashboard-table" id="results-table">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Submitted At</th>
                            </tr>
                        </thead>
                        <tbody id="results-table-body">
                            <!-- Results will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Zylos Exam Software - Secure Online Examination Platform</p>
            <p>Now available as an installable PWA app!</p>
            <p>Developed by <span class="developer">Srijit Mukherjee</span></p>
        </div>
    </footer>

    <!-- Full screen warning overlay (for strict mode) -->
    <div id="fullscreen-warning" class="fullscreen-overlay" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        <h2>Warning!</h2>
        <p>You have switched tabs/windows. This is not allowed during the exam.</p>
        <p>Return to the exam immediately or you will be kicked out.</p>
        <div class="timer" id="kick-timer">3</div>
    </div>

    <script>
        // ========== PWA CONFIGURATION ==========
        // Generate Web App Manifest dynamically
        const manifest = {
            "name": "Zylos Exam",
            "short_name": "Zylos",
            "description": "Secure online examination platform",
            "start_url": window.location.href,
            "display": "standalone",
            "background_color": "#f5f7fa",
            "theme_color": "#1a2a6c",
            "orientation": "portrait-primary",
            "icons": [
                {
                    "src": "/icon72.png",
                    "sizes": "72x72",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "/icon96.png",
                    "sizes": "96x96",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "/icon144.png",
                    "sizes": "144x144",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "/icon192.png",
                    "sizes": "192x192",
                    "type": "image/png",
                    "purpose": "any maskable"
                },
                {
                    "src": "/icon512.png",
                    "sizes": "512x512",
                    "type": "image/png",
                    "purpose": "any maskable"
                }
            ],
            "categories": ["education", "productivity", "utilities"],
            "scope": "/",
            "lang": "en"
        };

        // Create and inject manifest
        const manifestString = JSON.stringify(manifest);
        const manifestBlob = new Blob([manifestString], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('app-manifest').href = manifestURL;

        // PWA Variables
        let deferredPrompt;
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        const installPrompt = document.getElementById('installPrompt');
        const cancelInstallBtn = document.getElementById('cancelInstall');
        const confirmInstallBtn = document.getElementById('confirmInstall');

        // ========== PWA INSTALLATION HANDLING ==========
        // Listen for beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 76+ from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button
            pwaInstallBtn.classList.remove('hidden');
            
            // Show install prompt automatically after 5 seconds
            setTimeout(() => {
                if (!isAppInstalled()) {
                    installPrompt.style.display = 'flex';
                }
            }, 5000);
        });

        // Install button click handler
        pwaInstallBtn.addEventListener('click', () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        pwaInstallBtn.classList.add('hidden');
                        showInstallSuccessMessage();
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        });

        // Install prompt buttons
        confirmInstallBtn.addEventListener('click', () => {
            installPrompt.style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showInstallSuccessMessage();
                    }
                    deferredPrompt = null;
                });
            }
        });

        cancelInstallBtn.addEventListener('click', () => {
            installPrompt.style.display = 'none';
        });

        // Check if app is already installed
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true ||
                   document.referrer.includes('android-app://');
        }

        // Show install success message
        function showInstallSuccessMessage() {
            const successMsg = document.createElement('div');
            successMsg.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px; border-radius: 8px; z-index: 10002; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <i class="fas fa-check-circle"></i> App installed successfully!
                </div>
            `;
            document.body.appendChild(successMsg);
            setTimeout(() => successMsg.remove(), 3000);
        }

        // ========== SERVICE WORKER REGISTRATION ==========
        // Inline Service Worker Code
        const serviceWorkerCode = `
            self.addEventListener('install', event => {
                console.log('Zylos Exam PWA: Service Worker installing.');
                // Cache important resources
                event.waitUntil(
                    caches.open('zylos-v1').then(cache => {
                        return cache.addAll([
                            '/',
                            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                            'https://img.icons8.com/color/96/000000/exam.png'
                        ]);
                    })
                );
            });

            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request).then(response => {
                        return response || fetch(event.request);
                    })
                );
            });

            self.addEventListener('activate', event => {
                console.log('Zylos Exam PWA: Service Worker activated.');
            });
        `;

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create a Blob with the service worker code
                const serviceWorkerBlob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
                const serviceWorkerURL = URL.createObjectURL(serviceWorkerBlob);
                
                navigator.serviceWorker.register(serviceWorkerURL)
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // ========== OFFLINE DETECTION ==========
        window.addEventListener('online', () => {
            showStatusMessage('You are back online!', 'success');
        });

        window.addEventListener('offline', () => {
            showStatusMessage('You are offline. Some features may not work.', 'warning');
        });

        function showStatusMessage(message, type) {
            const statusDiv = document.createElement('div');
            const bgColor = type === 'success' ? '#28a745' : '#ffc107';
            statusDiv.innerHTML = \`
                <div style="position: fixed; top: 0; left: 0; width: 100%; background: \${bgColor}; color: white; text-align: center; padding: 10px; z-index: 10003;">
                    <i class="fas fa-\${type === 'success' ? 'wifi' : 'exclamation-triangle'}"></i> \${message}
                </div>
            \`;
            document.body.appendChild(statusDiv);
            setTimeout(() => statusDiv.remove(), 3000);
        }

        // Check initial online status
        if (!navigator.onLine) {
            showStatusMessage('You are offline. App is running in limited mode.', 'warning');
        }

        // ========== YOUR EXISTING JAVASCRIPT CODE ==========
        // Global variables
        let currentExam = null;
        let currentExamData = null;
        let examTimerInterval = null;
        let timeLeft = 0;
        let strictModeWarning = false;
        let kickCountdown = null;
        let studentHasStartedExam = false;

        // DOM elements
        const createExamCard = document.getElementById('create-exam-card');
        const takeExamCard = document.getElementById('take-exam-card');
        const resultsCard = document.getElementById('results-card');
        const tabs = document.querySelectorAll('.tab');
        const examTypeElements = document.querySelectorAll('.exam-type');
        const examTypeInput = document.getElementById('exam-type');
        const questionsContainer = document.getElementById('questions-container');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const examCreationForm = document.getElementById('exam-creation-form');
        const joinExamBtn = document.getElementById('join-exam-btn');
        const examEntry = document.getElementById('exam-entry');
        const examTaking = document.getElementById('exam-taking');
        const submitExamBtn = document.getElementById('submit-exam-btn');
        const loadDashboardBtn = document.getElementById('load-dashboard-btn');
        const dashboardContent = document.getElementById('dashboard-content');
        const strictWarning = document.getElementById('strict-warning');
        const fullscreenWarning = document.getElementById('fullscreen-warning');
        const kickTimer = document.getElementById('kick-timer');

        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding card
                createExamCard.classList.remove('active-card');
                takeExamCard.classList.remove('active-card');
                resultsCard.classList.remove('active-card');
                
                if (tabId === 'create') {
                    createExamCard.classList.add('active-card');
                } else if (tabId === 'take') {
                    takeExamCard.classList.add('active-card');
                } else if (tabId === 'results') {
                    resultsCard.classList.add('active-card');
                }
            });
        });

        // Exam type selection
        examTypeElements.forEach(typeElement => {
            typeElement.addEventListener('click', () => {
                examTypeElements.forEach(el => el.classList.remove('selected'));
                typeElement.classList.add('selected');
                examTypeInput.value = typeElement.getAttribute('data-type');
                
                // Update questions based on exam type
                updateQuestionsContainer();
            });
        });

        // Set default exam type
        document.querySelector('.exam-type[data-type="broad"]').classList.add('selected');

        // Function to update questions container based on exam type
        function updateQuestionsContainer() {
            questionsContainer.innerHTML = '';
            
            // Add 3 default questions
            for (let i = 0; i < 3; i++) {
                addQuestion();
            }
        }

        // Add question button
        addQuestionBtn.addEventListener('click', addQuestion);

        // Function to add a new question
        function addQuestion() {
            const examType = examTypeInput.value;
            const questionCount = document.querySelectorAll('.question-container').length + 1;
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-container';
            questionDiv.setAttribute('data-id', questionCount);
            
            let questionHTML = \`
                <h3>Question \${questionCount}</h3>
                <div class="form-group">
                    <label for="question-text-\${questionCount}">Question Text</label>
                    <textarea id="question-text-\${questionCount}" rows="3" placeholder="Enter your question here" required></textarea>
                </div>
                <div class="form-group">
                    <label for="question-marks-\${questionCount}">Marks</label>
                    <input type="number" id="question-marks-\${questionCount}" placeholder="e.g., 10" min="1" required>
                </div>
            \`;
            
            // Add options for MCQ and Mixed types
            if (examType === 'mcq' || examType === 'mixed') {
                questionHTML += \`
                    <div class="form-group">
                        <label>Options (Select correct option)</label>
                        <div class="option-container" id="options-container-\${questionCount}">
                            <div class="option-label">
                                <input type="radio" name="correct-option-\${questionCount}" value="0" required>
                                <input type="text" class="option-text" placeholder="Option A" required>
                            </div>
                            <div class="option-label">
                                <input type="radio" name="correct-option-\${questionCount}" value="1" required>
                                <input type="text" class="option-text" placeholder="Option B" required>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary add-option-btn" data-question="\${questionCount}" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Add Option
                        </button>
                    </div>
                \`;
            }
            
            // Add remove question button
            questionHTML += \`
                <button type="button" class="btn btn-danger remove-question-btn" data-id="\${questionCount}" style="margin-top: 15px;">
                    <i class="fas fa-trash"></i> Remove Question
                </button>
            \`;
            
            questionDiv.innerHTML = questionHTML;
            questionsContainer.appendChild(questionDiv);
            
            // Add event listeners for the new question
            const removeBtn = questionDiv.querySelector('.remove-question-btn');
            removeBtn.addEventListener('click', function() {
                if (document.querySelectorAll('.question-container').length > 1) {
                    questionDiv.remove();
                    renumberQuestions();
                } else {
                    alert('At least one question is required.');
                }
            });
            
            // Add option button for MCQ/mixed
            if (examType === 'mcq' || examType === 'mixed') {
                const addOptionBtn = questionDiv.querySelector('.add-option-btn');
                addOptionBtn.addEventListener('click', function() {
                    const questionId = this.getAttribute('data-question');
                    addOption(questionId);
                });
            }
        }

        // Function to add an option to MCQ question
        function addOption(questionId) {
            const optionsContainer = document.getElementById(\`options-container-\${questionId}\`);
            const optionCount = optionsContainer.querySelectorAll('.option-label').length;
            const optionLetters = ['A', 'B', 'C', 'D', 'E', 'F'];
            
            if (optionCount < 6) {
                const optionLabel = document.createElement('div');
                optionLabel.className = 'option-label';
                optionLabel.innerHTML = \`
                    <input type="radio" name="correct-option-\${questionId}" value="\${optionCount}" required>
                    <input type="text" class="option-text" placeholder="Option \${optionLetters[optionCount]}" required>
                    <button type="button" class="remove-option-btn" style="margin-left: auto; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">Ã—</button>
                \`;
                
                optionsContainer.appendChild(optionLabel);
                
                // Add event listener for remove option button
                const removeOptionBtn = optionLabel.querySelector('.remove-option-btn');
                removeOptionBtn.addEventListener('click', function() {
                    if (optionsContainer.querySelectorAll('.option-label').length > 2) {
                        optionLabel.remove();
                    } else {
                        alert('At least two options are required.');
                    }
                });
            } else {
                alert('Maximum 6 options allowed per question.');
            }
        }

        // Function to renumber questions after removal
        function renumberQuestions() {
            const questionContainers = document.querySelectorAll('.question-container');
            questionContainers.forEach((container, index) => {
                const newId = index + 1;
                container.setAttribute('data-id', newId);
                container.querySelector('h3').textContent = \`Question \${newId}\`;
                
                // Update IDs and names of inputs
                const textarea = container.querySelector('textarea');
                const marksInput = container.querySelector('input[type="number"]');
                const addOptionBtn = container.querySelector('.add-option-btn');
                const removeBtn = container.querySelector('.remove-question-btn');
                
                if (textarea) {
                    textarea.id = \`question-text-\${newId}\`;
                }
                
                if (marksInput) {
                    marksInput.id = \`question-marks-\${newId}\`;
                }
                
                if (addOptionBtn) {
                    addOptionBtn.setAttribute('data-question', newId);
                    
                    // Update radio button names
                    const radioButtons = container.querySelectorAll('input[type="radio"]');
                    radioButtons.forEach(radio => {
                        radio.name = \`correct-option-\${newId}\`;
                    });
                    
                    // Update options container ID
                    const optionsContainer = container.querySelector('.option-container');
                    if (optionsContainer) {
                        optionsContainer.id = \`options-container-\${newId}\`;
                    }
                }
                
                if (removeBtn) {
                    removeBtn.setAttribute('data-id', newId);
                }
            });
        }

        // Initialize with 3 questions
        updateQuestionsContainer();

        // Create exam form submission
        examCreationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const teacherName = document.getElementById('teacher-name').value;
            const examTitle = document.getElementById('exam-title').value;
            const totalMarks = document.getElementById('total-marks').value;
            const examDuration = document.getElementById('exam-duration').value;
            const examType = examTypeInput.value;
            
            // Collect questions
            const questions = [];
            const questionContainers = document.querySelectorAll('.question-container');
            
            questionContainers.forEach((container, index) => {
                const questionId = index + 1;
                const questionText = document.getElementById(\`question-text-\${questionId}\`).value;
                const questionMarks = document.getElementById(\`question-marks-\${questionId}\`).value;
                
                const question = {
                    id: questionId,
                    text: questionText,
                    marks: parseInt(questionMarks)
                };
                
                // For MCQ and Mixed exams, collect options
                if (examType === 'mcq' || examType === 'mixed') {
                    question.options = [];
                    const optionLabels = container.querySelectorAll('.option-label');
                    
                    optionLabels.forEach((label, optIndex) => {
                        const optionText = label.querySelector('.option-text').value;
                        const isCorrect = label.querySelector('input[type="radio"]').checked;
                        
                        question.options.push({
                            id: optIndex,
                            text: optionText,
                            correct: isCorrect
                        });
                    });
                    
                    // Validate that one option is marked as correct
                    const hasCorrectOption = Array.from(optionLabels).some(label => 
                        label.querySelector('input[type="radio"]').checked
                    );
                    
                    if (!hasCorrectOption) {
                        alert(\`Please mark the correct option for Question \${questionId}\`);
                        throw new Error('No correct option selected');
                    }
                }
                
                questions.push(question);
            });
            
            // Generate unique exam ID
            const examId = 'exam_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Create exam object
            const exam = {
                id: examId,
                teacherName,
                examTitle,
                totalMarks: parseInt(totalMarks),
                duration: parseInt(examDuration), // in minutes
                type: examType,
                questions,
                createdAt: new Date().toISOString(),
                students: [] // To store student submissions
            };
            
            // Store exam in localStorage
            localStorage.setItem(examId, JSON.stringify(exam));
            
            // Generate links
            const baseUrl = window.location.origin + window.location.pathname;
            const examLink = \`\${baseUrl}?exam=\${examId}\`;
            const dashboardLink = \`\${baseUrl}?dashboard=\${examId}\`;
            
            // Display links
            alert('Exam created successfully! Switch to the "Results Dashboard" tab to access your exam and dashboard links.');
            
            // Reset form
            examCreationForm.reset();
            document.querySelector('.exam-type[data-type="broad"]').classList.add('selected');
            examTypeInput.value = 'broad';
            updateQuestionsContainer();
            
            // Switch to results tab
            document.querySelector('.tab[data-tab="results"]').click();
            
            // Pre-fill dashboard link
            document.getElementById('dashboard-link').value = dashboardLink;
            loadDashboard();
        });

        // Join exam button
        joinExamBtn.addEventListener('click', function() {
            const examLink = document.getElementById('exam-link').value;
            const studentName = document.getElementById('student-name').value;
            
            if (!examLink || !studentName) {
                alert('Please enter both exam link and your name.');
                return;
            }
            
            // Extract exam ID from the link
            const urlParams = new URLSearchParams(examLink.split('?')[1]);
            const examId = urlParams.get('exam');
            
            if (!examId) {
                alert('Invalid exam link. Please check the link and try again.');
                return;
            }
            
            // Check if exam exists
            const examData = localStorage.getItem(examId);
            if (!examData) {
                alert('Exam not found. The link may be expired or invalid.');
                return;
            }
            
            const exam = JSON.parse(examData);
            
            // Check if student has already taken this exam
            const studentAlreadyTaken = exam.students.some(student => 
                student.name.toLowerCase() === studentName.toLowerCase()
            );
            
            if (studentAlreadyTaken) {
                alert('You have already taken this exam. Each student can only take the exam once.');
                return;
            }
            
            // Store current exam data in sessionStorage for the exam taking page
            sessionStorage.setItem('currentExamId', examId);
            sessionStorage.setItem('studentName', studentName);
            
            // Show exam taking interface
            examEntry.style.display = 'none';
            examTaking.style.display = 'block';
            
            // Set exam details
            document.getElementById('current-student-name').textContent = studentName;
            document.getElementById('current-exam-title').textContent = exam.examTitle;
            
            // Initialize exam
            loadExamForStudent(exam);
        });

        // Load exam for student
        function loadExamForStudent(exam) {
            currentExam = exam;
            currentExamData = exam;
            
            // Set timer
            timeLeft = exam.duration * 60; // Convert to seconds
            updateTimerDisplay();
            
            // Start timer
            clearInterval(examTimerInterval);
            examTimerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(examTimerInterval);
                    submitExam();
                    alert('Time is up! Your exam has been submitted automatically.');
                }
                
                // Show warning when 5 minutes left
                if (timeLeft === 300) {
                    alert('Warning: Only 5 minutes remaining!');
                }
            }, 1000);
            
            // Load questions
            const examQuestionsContainer = document.getElementById('exam-questions-container');
            examQuestionsContainer.innerHTML = '';
            
            exam.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.setAttribute('data-question-id', question.id);
                
                let questionHTML = \`
                    <h3>Question \${index + 1} (\${question.marks} marks)</h3>
                    <p>\${question.text}</p>
                \`;
                
                // Add input based on exam type
                if (exam.type === 'broad') {
                    questionHTML += \`
                        <div class="form-group">
                            <label for="answer-\${question.id}">Your Answer:</label>
                            <textarea id="answer-\${question.id}" rows="5" placeholder="Type your answer here"></textarea>
                        </div>
                        <div class="warning">
                            <i class="fab fa-whatsapp"></i>
                            <div>For broad questions, you must also send your answer to the teacher's WhatsApp number after submitting.</div>
                        </div>
                    \`;
                } else if (exam.type === 'mcq') {
                    questionHTML += \`<div class="form-group">\`;
                    question.options.forEach((option, optIndex) => {
                        const optionId = \`question-\${question.id}-option-\${optIndex}\`;
                        questionHTML += \`
                            <div class="option-label">
                                <input type="radio" id="\${optionId}" name="question-\${question.id}" value="\${optIndex}">
                                <label for="\${optionId}" style="margin-bottom: 0; cursor: pointer; flex: 1;">\${option.text}</label>
                            </div>
                        \`;
                    });
                    questionHTML += \`</div>\`;
                } else if (exam.type === 'mixed') {
                    // For mixed exams, check if question has options (MCQ) or not (broad)
                    if (question.options && question.options.length > 0) {
                        questionHTML += \`<div class="form-group">\`;
                        question.options.forEach((option, optIndex) => {
                            const optionId = \`question-\${question.id}-option-\${optIndex}\`;
                            questionHTML += \`
                                <div class="option-label">
                                    <input type="radio" id="\${optionId}" name="question-\${question.id}" value="\${optIndex}">
                                    <label for="\${optionId}" style="margin-bottom: 0; cursor: pointer; flex: 1;">\${option.text}</label>
                                </div>
                            \`;
                        });
                        questionHTML += \`</div>\`;
                    } else {
                        questionHTML += \`
                            <div class="form-group">
                                <label for="answer-\${question.id}">Your Answer:</label>
                                <textarea id="answer-\${question.id}" rows="5" placeholder="Type your answer here"></textarea>
                            </div>
                            <div class="warning">
                                <i class="fab fa-whatsapp"></i>
                                <div>For broad questions, you must also send your answer to the teacher's WhatsApp number after submitting.</div>
                            </div>
                        \`;
                    }
                }
                
                questionDiv.innerHTML = questionHTML;
                examQuestionsContainer.appendChild(questionDiv);
            });
            
            // Show strict warning
            strictWarning.style.display = 'block';
            studentHasStartedExam = true;
            
            // Enable strict exam mode
            enableStrictExamMode();
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerDisplay = document.getElementById('exam-timer');
            
            timerDisplay.textContent = \`\${minutes.toString().padStart(2, '0')}:\${seconds.toString().padStart(2, '0')}\`;
            
            // Change color when less than 10 minutes left
            if (timeLeft < 600) {
                timerDisplay.classList.add('warning-time');
            } else {
                timerDisplay.classList.remove('warning-time');
            }
        }

        // Submit exam
        submitExamBtn.addEventListener('click', submitExam);

        function submitExam() {
            if (!currentExam || !studentHasStartedExam) return;
            
            const studentName = sessionStorage.getItem('studentName');
            const examId = sessionStorage.getItem('currentExamId');
            
            // Calculate score
            let score = 0;
            const answers = [];
            
            currentExam.questions.forEach((question, index) => {
                let studentAnswer;
                
                if (currentExam.type === 'broad') {
                    const answerTextarea = document.getElementById(\`answer-\${question.id}\`);
                    studentAnswer = answerTextarea ? answerTextarea.value : '';
                    
                    // For broad questions, we can't auto-grade, so no score added
                    answers.push({
                        questionId: question.id,
                        answer: studentAnswer,
                        marksAwarded: 0 // Teacher will grade manually
                    });
                } else if (currentExam.type === 'mcq' || 
                          (currentExam.type === 'mixed' && question.options && question.options.length > 0)) {
                    const selectedOption = document.querySelector(\`input[name="question-\${question.id}"]:checked\`);
                    
                    if (selectedOption) {
                        const selectedOptionIndex = parseInt(selectedOption.value);
                        const isCorrect = question.options[selectedOptionIndex].correct;
                        
                        studentAnswer = question.options[selectedOptionIndex].text;
                        
                        if (isCorrect) {
                            score += question.marks;
                        }
                        
                        answers.push({
                            questionId: question.id,
                            answer: studentAnswer,
                            isCorrect: isCorrect,
                            marksAwarded: isCorrect ? question.marks : 0
                        });
                    } else {
                        answers.push({
                            questionId: question.id,
                            answer: '',
                            isCorrect: false,
                            marksAwarded: 0
                        });
                    }
                } else if (currentExam.type === 'mixed') {
                    // Mixed exam broad question
                    const answerTextarea = document.getElementById(\`answer-\${question.id}\`);
                    studentAnswer = answerTextarea ? answerTextarea.value : '';
                    
                    answers.push({
                        questionId: question.id,
                        answer: studentAnswer,
                        marksAwarded: 0 // Teacher will grade manually
                    });
                }
            });
            
            // Create student submission
            const studentSubmission = {
                name: studentName,
                score: score,
                answers: answers,
                submittedAt: new Date().toISOString(),
                completed: true,
                kicked: false
            };
            
            // Update exam data with student submission
            const examData = JSON.parse(localStorage.getItem(examId));
            examData.students.push(studentSubmission);
            localStorage.setItem(examId, JSON.stringify(examData));
            
            // Clear strict mode
            disableStrictExamMode();
            clearInterval(examTimerInterval);
            
            // Show success message
            alert(\`Exam submitted successfully! Your score: \${score}/\${currentExam.totalMarks}\`);
            
            // Reset UI
            examEntry.style.display = 'block';
            examTaking.style.display = 'none';
            strictWarning.style.display = 'none';
            document.getElementById('exam-link').value = '';
            document.getElementById('student-name').value = '';
            
            studentHasStartedExam = false;
        }

        // Load dashboard
        loadDashboardBtn.addEventListener('click', loadDashboard);

        function loadDashboard() {
            const dashboardLink = document.getElementById('dashboard-link').value;
            
            if (!dashboardLink) {
                alert('Please enter a dashboard link.');
                return;
            }
            
            // Extract exam ID from the link
            const urlParams = new URLSearchParams(dashboardLink.split('?')[1]);
            const examId = urlParams.get('dashboard');
            
            if (!examId) {
                alert('Invalid dashboard link. Please check the link and try again.');
                return;
            }
            
            // Check if exam exists
            const examData = localStorage.getItem(examId);
            if (!examData) {
                alert('Dashboard not found. The link may be expired or invalid.');
                return;
            }
            
            const exam = JSON.parse(examData);
            
            // Show dashboard content
            dashboardContent.style.display = 'block';
            
            // Set exam title
            document.getElementById('dashboard-exam-title').textContent = \`\${exam.examTitle} - Created by \${exam.teacherName}\`;
            
            // Generate and display links
            const baseUrl = window.location.origin + window.location.pathname;
            const examLink = \`\${baseUrl}?exam=\${examId}\`;
            const dashboardLinkFull = \`\${baseUrl}?dashboard=\${examId}\`;
            
            document.getElementById('dashboard-exam-link').textContent = examLink;
            document.getElementById('dashboard-dashboard-link').textContent = dashboardLinkFull;
            
            // Copy link buttons
            document.querySelector('.copy-exam-link').addEventListener('click', function() {
                navigator.clipboard.writeText(examLink);
                this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-copy"></i> Copy';
                }, 2000);
            });
            
            document.querySelector('.copy-dashboard-link').addEventListener('click', function() {
                navigator.clipboard.writeText(dashboardLinkFull);
                this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-copy"></i> Copy';
                }, 2000);
            });
            
            // Load student results
            const resultsTableBody = document.getElementById('results-table-body');
            resultsTableBody.innerHTML = '';
            
            if (exam.students.length === 0) {
                resultsTableBody.innerHTML = \`
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px;">
                            No students have taken the exam yet.
                        </td>
                    </tr>
                \`;
            } else {
                exam.students.forEach(student => {
                    const row = document.createElement('tr');
                    
                    // Format submitted date
                    const submittedDate = new Date(student.submittedAt);
                    const formattedDate = submittedDate.toLocaleDateString() + ' ' + submittedDate.toLocaleTimeString();
                    
                    // Determine status
                    let status = 'Completed';
                    if (student.kicked) {
                        status = '<span class="kicked-warning">Kicked Out</span>';
                    } else if (!student.completed) {
                        status = 'Incomplete';
                    }
                    
                    row.innerHTML = \`
                        <td>\${student.name}</td>
                        <td><strong>\${student.score}/\${exam.totalMarks}</strong></td>
                        <td>\${status}</td>
                        <td>\${formattedDate}</td>
                    \`;
                    
                    resultsTableBody.appendChild(row);
                });
            }
        }

        // Strict exam mode functions
        function enableStrictExamMode() {
            // Track visibility changes
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // Track tab/window focus
            window.addEventListener('blur', handleWindowBlur);
            window.addEventListener('focus', handleWindowFocus);
            
            // Prevent copy
            document.addEventListener('copy', preventCopy);
            document.addEventListener('cut', preventCopy);
            
            // Prevent context menu
            document.addEventListener('contextmenu', preventContextMenu);
            
            // Prevent keyboard shortcuts
            document.addEventListener('keydown', preventShortcuts);
        }

        function disableStrictExamMode() {
            document.removeEventListener('visibilitychange', handleVisibilityChange);
            window.removeEventListener('blur', handleWindowBlur);
            window.removeEventListener('focus', handleWindowFocus);
            document.removeEventListener('copy', preventCopy);
            document.removeEventListener('cut', preventCopy);
            document.removeEventListener('contextmenu', preventContextMenu);
            document.removeEventListener('keydown', preventShortcuts);
            
            // Hide fullscreen warning if visible
            fullscreenWarning.style.display = 'none';
            if (kickCountdown) {
                clearInterval(kickCountdown);
                kickCountdown = null;
            }
        }

        function handleVisibilityChange() {
            if (document.hidden && studentHasStartedExam) {
                // Student switched tabs
                showFullscreenWarning();
            }
        }

        function handleWindowBlur() {
            if (studentHasStartedExam) {
                showFullscreenWarning();
            }
        }

        function handleWindowFocus() {
            // Hide warning when user returns
            fullscreenWarning.style.display = 'none';
            if (kickCountdown) {
                clearInterval(kickCountdown);
                kickCountdown = null;
            }
        }

        function showFullscreenWarning() {
            fullscreenWarning.style.display = 'flex';
            let countdown = 3;
            kickTimer.textContent = countdown;
            
            kickCountdown = setInterval(() => {
                countdown--;
                kickTimer.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(kickCountdown);
                    kickStudentOut();
                }
            }, 1000);
        }

        function kickStudentOut() {
            // Mark student as kicked
            const studentName = sessionStorage.getItem('studentName');
            const examId = sessionStorage.getItem('currentExamId');
            
            if (examId && studentName) {
                const examData = JSON.parse(localStorage.getItem(examId));
                const studentIndex = examData.students.findIndex(student => 
                    student.name.toLowerCase() === studentName.toLowerCase()
                );
                
                if (studentIndex === -1) {
                    // Add student as kicked if not already submitted
                    const studentSubmission = {
                        name: studentName,
                        score: 0,
                        answers: [],
                        submittedAt: new Date().toISOString(),
                        completed: false,
                        kicked: true
                    };
                    
                    examData.students.push(studentSubmission);
                    localStorage.setItem(examId, JSON.stringify(examData));
                } else {
                    // Update existing student as kicked
                    examData.students[studentIndex].kicked = true;
                    examData.students[studentIndex].completed = false;
                    localStorage.setItem(examId, JSON.stringify(examData));
                }
            }
            
            // Reset UI
            disableStrictExamMode();
            clearInterval(examTimerInterval);
            examEntry.style.display = 'block';
            examTaking.style.display = 'none';
            strictWarning.style.display = 'none';
            fullscreenWarning.style.display = 'none';
            
            alert('You have been kicked out of the exam for violating the rules.');
            
            studentHasStartedExam = false;
        }

        function preventCopy(e) {
            e.preventDefault();
            return false;
        }

        function preventContextMenu(e) {
            e.preventDefault();
            return false;
        }

        function preventShortcuts(e) {
            // Prevent Ctrl+C, Ctrl+V, Ctrl+X, etc.
            if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'x' || e.key === 'a')) {
                e.preventDefault();
                return false;
            }
            
            // Prevent F12 (DevTools)
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
        }

        // Check if there's an exam ID in URL (for direct linking)
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const examId = urlParams.get('exam');
            const dashboardId = urlParams.get('dashboard');
            
            if (examId) {
                // Student is joining via exam link
                document.querySelector('.tab[data-tab="take"]').click();
                document.getElementById('exam-link').value = window.location.href;
            } else if (dashboardId) {
                // Teacher is accessing dashboard via link
                document.querySelector('.tab[data-tab="results"]').click();
                document.getElementById('dashboard-link').value = window.location.href;
                loadDashboard();
            }
            
            // Check if app is already installed
            if (isAppInstalled()) {
                pwaInstallBtn.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
